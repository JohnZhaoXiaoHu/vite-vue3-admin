var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,r=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))i.call(t,a)&&l(e,a,t[a]);return e},o=(e,n)=>t(e,a(n));import{d as c,bj as d,ag as p,s as u,u as m,f,q as y,E as b,e as h,c as v,w,G as g,r as k,M as I,aU as R,b8 as S,l as C,b as K}from"./vendor.f13de6ab.js";import{_ as x}from"./index.e22eb348.js";import{a as j,d as O,p as T,g as A,b as D}from"./index.6458f1ce.js";import{j as L,l as N}from"./index.fc610771.js";var _=c({name:"AccessTree",components:{[d.name]:d,[p.name]:p},props:{value:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:t}){const a=u({treeData:[],spinning:!1,replaceFields:{key:"id"}}),n=(e,t=-1)=>e.filter((e=>e.moduleId==t)).map((t=>o(r({},t),{title:t.moduleName||t.actionName,children:n(e,t.id)}))),s=m({get:()=>e.value,set:e=>t("update:value",Array.isArray(e)?e:e.checked)});f((async()=>{a.spinning=!0;const e=await j().finally((()=>a.spinning=!1));a.treeData=n(e)}));const i=(e,t=[])=>e.eventKey?(t.push(e.eventKey),i(e.vcTreeNode,t)):t,l=(e,t=[])=>(null==e?void 0:e.children.length)>0?e.children.reduce(((e,t)=>(t.children.length>0&&e.push(...l(t,e),[]),e.concat([t.id]))),t):t;return o(r({},y(a)),{checkedKeys:s,onCheck:(e,{node:t,checked:a})=>{var n,r,o;let c=s.value;if(a)c=[...new Set([...s.value,...e.checked,...i(t.vcTreeNode),...l(t.dataRef)])];else{const a=l(t.dataRef);c=a.length>0?e.checked.filter((e=>!a.includes(e))):e.checked;((null==(o=null==(r=null==(n=t.vcTreeNode)?void 0:n.dataRef)?void 0:r.children)?void 0:o.map((e=>e.id)))||[]).some((e=>c.includes(e)))||(c=c.filter((e=>{var a;return e!=(null==(a=t.vcTreeNode)?void 0:a.eventKey)})))}s.value=c}})}});_.render=function(e,t,a,n,s,i){const l=b("a-tree"),r=b("a-spin");return h(),v(r,{spinning:e.spinning},{default:w((()=>[g(l,{checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":t[0]||(t[0]=t=>e.checkedKeys=t),style:{"min-height":"40px"},checkable:"",checkStrictly:"",selectable:!1,"tree-data":e.treeData,"replace-fields":e.replaceFields,onCheck:e.onCheck},null,8,["checkedKeys","tree-data","replace-fields","onCheck"])])),_:1},8,["spinning"])};const P=()=>({style:{width:"auto"},formItemLayout:{labelCol:{span:4},wrapperCol:{span:20}},formItem:[{type:"input",label:"角色名称",field:"title",value:"",props:{placeholder:"请输入角色名称"},rules:[{required:!0,message:"角色名称不能为空"}]},{type:"textarea",label:"描述",field:"description",value:"",props:{placeholder:"角色描述"}},{type:g(_),label:"资源",field:"accessIdsList",value:[],asyncValue:async(e,t)=>{const{id:a}=null==t?void 0:t.props.fields;return(await j(a)).map((e=>e.accessId))}}]}),E=[{title:"角色名称",dataIndex:"title"},{title:"描述",dataIndex:"description"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>L(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},t)=>await O(e.id).then((()=>t()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},t)=>N({title:"编辑角色",fields:e,formSchema:P(),handleOk:async(a,n)=>{const{description:s,title:i,accessIdsList:l}=a,r={description:s,title:i,accessIdsList:l.toString()};return await T(e.id,r).then((()=>t()))}})}]}];var F=c({name:"SystemRole",components:{DynamicTable:x},setup(){const e=k(),t=u({tableLoading:!1,rowSelection:{onChange:(e,a)=>{t.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),a=m((()=>0==t.rowSelection.selectedRowKeys.length));return o(r({},y(t)),{columns:E,tableRef:e,isDisabled:a,getAdminRole:A,printTable:()=>{var t;const a=null==(t=e.value)?void 0:t.$el.querySelector(".ant-table-content").cloneNode(!0);a.setAttribute("id","printContainer"),document.body.append(a);const n=()=>{a.remove(),window.removeEventListener("afterprint",n)};window.addEventListener("afterprint",n),document.execCommand("print")},addItem:()=>{N({title:"添加角色",formSchema:P(),handleOk:async(t,a)=>{var n;const{description:s,title:i,accessIdsList:l}=t,r={description:s,title:i,accessIdsList:l.toString()};await D(r),null==(n=e.value)||n.refreshTableData()}})},deleteItems:()=>{I.confirm({title:"提示",icon:g(R),content:"您确定要删除所有选中吗？",onOk:async()=>{var a;await O(t.rowSelection.selectedRowKeys.toString()),null==(a=e.value)||a.refreshTableData(),t.rowSelection.selectedRowKeys=[]}})}})}});const q=K(" 添加 "),U=K(" 打印表格 "),G=K(" 删除 ");F.render=function(e,t,a,n,s,i){const l=b("a-button"),r=b("dynamic-table"),o=S("permission");return h(),v(r,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminRole,rowKey:"id","row-selection":e.rowSelection},{title:w((()=>[C(g(l,{type:"primary",onClick:e.addItem},{default:w((()=>[q])),_:1},8,["onClick"]),[[o,{action:"create",effect:"disabled"}]]),g(l,{type:"primary",onClick:e.printTable},{default:w((()=>[U])),_:1},8,["onClick"]),C(g(l,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:w((()=>[G])),_:1},8,["disabled","onClick"]),[[o,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection"])};export{F as default};
