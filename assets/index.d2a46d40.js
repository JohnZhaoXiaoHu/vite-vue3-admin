var e,a=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(e,t,s)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,i=(e,a)=>{for(var t in a||(a={}))l.call(a,t)&&n(e,t,a[t]);if(r)for(var t of r(a))o.call(a,t)&&n(e,t,a[t]);return e},d=(e,a)=>t(e,s(a));import{d as u,r as c,s as m,u as p,q as f,M as y,G as b,aU as w,E as v,b8 as h,e as g,i as q,w as P,j as S,l as x,b as D}from"./vendor.f13de6ab.js";import{_ as j,a as T}from"./index.e22eb348.js";import{A as O,R,j as A,l as k}from"./index.fc610771.js";import{g as I}from"./index.6458f1ce.js";function _(a){return O.request({url:[e.adminAccount,a].join("/"),method:R.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(e||(e={})).adminAccount="/admin/account";const E=()=>({formItem:[{type:"input",label:"用户名",field:"username",value:"",props:{placeholder:"请输入用户名"},rules:[{required:!0,message:"用户名不能为空"}]},{type:"input",label:"密码",field:"password",hidden:!1,value:"",props:{type:"password",placeholder:"请输入密码"},rules:[{required:!0,message:"密码不能为空"}]},{type:"checkbox",label:"角色",field:"roles",value:[],options:[],loading:!0,rules:[{required:!0,message:"请选择角色",type:"array"}],asyncOptions:async()=>{const{data:e}=await I({});return e.map((e=>({label:e.title,value:e.id})))}}]}),C=[{title:"用户名",dataIndex:"username"},{title:"所属角色",dataIndex:"roles",slots:{customRender:"roles"},slotsType:"format",slotsFunc:e=>e.map((e=>e.title)).join(", ")},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>A(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>A(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>await _(e.id).then((()=>a()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:a},t)=>k({title:"编辑账号",fields:d(i({},a),{roles:null==a?void 0:a.roles.map((e=>e.id))}),hiddenFields:["password"],formSchema:E(),handleOk:async(s,r)=>{const{username:l,password:o,roles:n}=s,i={username:l,password:o,roles:n.toString()};return await function(a,t){return O.request({url:[e.adminAccount,a].join("/"),method:R.PATCH,params:t},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(a.id,i).then((()=>t()))}})}]}];var M=u({name:"SystemAccount",components:{DynamicTable:j,TableQueryHeader:T},setup(){const a=c(),t=m({queryParam:{name:"",status:"",startDate:"",endDate:""},tableLoading:!1,rowSelection:{onChange:(e,a)=>{t.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),s=p((()=>0==t.rowSelection.selectedRowKeys.length));return d(i({},f(t)),{columns:C,tableRef:a,isDisabled:s,loadData:a=>function(a){return O.request({url:e.adminAccount,method:R.GET,params:a},{isShowErrorMessage:!0})}(i(i({},a),t.queryParam)),addItem:()=>{k({title:"添加账号",formSchema:E(),handleOk:async(t,s)=>{var r;const{username:l,password:o,roles:n}=t,i={username:l,password:o,roles:n.toString()};await function(a){return O.request({url:e.adminAccount,method:R.POST,params:a},{isShowErrorMessage:!0,successMessageText:"新建成功"})}(i),null==(r=a.value)||r.refreshTableData()}})},deleteItems:()=>{y.confirm({title:"提示",icon:b(w),content:"您确定要删除所有选中吗？",onOk:async()=>{var e;await _(t.rowSelection.selectedRowKeys.toString()),null==(e=a.value)||e.refreshTableData(),t.rowSelection.selectedRowKeys=[]}})}})}});const K=["label"],L=["label"],U=D("请选择"),F=D("已停用"),G=D("已启用"),H=["label"],Q=["label"],z=D("查询"),B=D("重置"),J=D(" 添加 "),N=D(" 删除 ");M.render=function(e,a,t,s,r,l){const o=v("a-input"),n=v("a-select-option"),i=v("a-select"),d=v("a-date-picker"),u=v("a-button"),c=v("table-query-header"),m=v("dynamic-table"),p=h("permission");return g(),q("div",null,[b(c,null,{item:P((({setLabel:t})=>[S("div",{label:t("账号名称")},[b(o,{value:e.queryParam.name,"onUpdate:value":a[0]||(a[0]=a=>e.queryParam.name=a),placeholder:""},null,8,["value"])],8,K)])),item2:P((({setLabel:t})=>[S("div",{label:t("状态")},[b(i,{value:e.queryParam.status,"onUpdate:value":a[1]||(a[1]=a=>e.queryParam.status=a),placeholder:"请选择","default-value":""},{default:P((()=>[b(n,{value:""},{default:P((()=>[U])),_:1}),b(n,{value:"0"},{default:P((()=>[F])),_:1}),b(n,{value:"1"},{default:P((()=>[G])),_:1})])),_:1},8,["value"])],8,L)])),item3:P((({setLabel:t})=>[S("div",{label:t("开始日期")},[b(d,{value:e.queryParam.startDate,"onUpdate:value":a[2]||(a[2]=a=>e.queryParam.startDate=a),style:{width:"100%"},placeholder:"开始日期"},null,8,["value"])],8,H)])),item4:P((({setLabel:t})=>[S("div",{label:t("结束日期")},[b(d,{value:e.queryParam.endDate,"onUpdate:value":a[3]||(a[3]=a=>e.queryParam.endDate=a),style:{width:"100%"},placeholder:"结束日期"},null,8,["value"])],8,Q)])),buttons:P((()=>[b(u,{type:"primary",onClick:a[4]||(a[4]=a=>{var t;return null==(t=e.tableRef)?void 0:t.refreshTableData({},!0)})},{default:P((()=>[z])),_:1}),b(u,{style:{"margin-left":"8px"},onClick:a[5]||(a[5]=()=>e.queryParam={})},{default:P((()=>[B])),_:1})])),_:1}),b(m,{ref:"tableRef",columns:e.columns,"get-list-func":e.loadData,rowKey:"id","row-selection":e.rowSelection},{title:P((()=>[x(b(u,{type:"primary",onClick:e.addItem},{default:P((()=>[J])),_:1},8,["onClick"]),[[p,{action:"create",effect:"disabled"}]]),x(b(u,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:P((()=>[N])),_:1},8,["disabled","onClick"]),[[p,{action:"delete"}]])])),_:1},8,["columns","get-list-func","row-selection"])])};export{M as default};
