!function(){var e=document.createElement("style");e.innerHTML=".loading-icon{border:none}.loading-icon.ant-table-row-expanded:after{content:none}\n",document.head.appendChild(e),System.register(["./vendor-legacy.e71c8e14.js","./index-legacy.b24d49a4.js","./index-legacy.b2e53b1b.js","./icon-font-legacy.02061d92.js"],(function(e){"use strict";var a,l,t,o,n,d,s,i,r,u,c,m,f,p,v,y,b,R,w,g,h,k,I,x,A,_,N,C,E,S,T,q,L,M,O,U,j;return{setters:[function(e){a=e.ak,l=e.G,t=e.R,o=e.b4,n=e.d,d=e.M,s=e.af,i=e.aa,r=e.ab,u=e.ad,c=e.r,m=e.s,f=e.f,p=e.q,v=e.E,y=e.e,b=e.c,R=e.w,w=e.a0,g=e.i,h=e.k,k=e.b,I=e.t,x=e.F,A=e.j,_=e.A,N=e.u,C=e.aU,E=e.b8,S=e.l},function(e){T=e._},function(e){q=e.A,L=e.R,M=e.h,O=e.j,U=e.k},function(e){j=e.I}],execute:function(){var P,F;function D(e){return q.request({url:P.adminAccess,method:L.GET,params:e})}function K(e){return q.request({url:[P.adminAccess,e].join("/"),method:L.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(F=P||(P={})).adminAccess="/admin/access",F.adminAccessModule="/admin/access/module";var G=n({name:"OperateModal",components:{[d.name]:d,[s.name]:s,[s.Item.name]:s.Item,[i.name]:i,[r.name]:r,[u.name]:u,ASelectOption:u.Option},props:{remove:{type:Function},fields:{type:Object,default:()=>({})},callback:{type:Function}},setup(e){const a=c(null),l=m({visible:!0,confirmLoading:!1,moduleList:[]}),t=m({moduleName:"",moduleId:void 0,actionName:"",viewPath:"",type:void 0,url:"",icon:"",sort:1,keepAlive:1});e.fields.moduleId&&(Object.keys(t).forEach((a=>t[a]=e.fields[a])),t.type=-1==e.fields.moduleId?1:2);f((async()=>{var e;l.moduleList=await q.request({url:P.adminAccessModule,method:L.GET,params:e})}));return{...p(l),formRef:a,rules:{moduleName:[{required:!0,message:"模块名称不能为空"}],moduleId:[{required:!0,message:"模块名称不能为空"}],actionName:[{required:!0,message:"请输入菜单名称"}],type:[{required:!0,message:"请选择类型"}],url:[{required:!0,message:"请输入url地址"}]},prefix:"/vite-vue3-admin/",labelCol:{span:4},wrapperCol:{span:20},modelRef:t,constantRouterComponents:M,handleOk:async o=>{o.preventDefault(),l.confirmLoading=!0;try{await a.value.validate();const o=e.fields.id,n={...t};n.viewPath??(n.viewPath=""),o&&Reflect.deleteProperty(n,"type"),await(o?function(e,a){return q.request({url:[P.adminAccess,e].join("/"),method:L.PATCH,params:a},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(o,n):function(e){return q.request({url:P.adminAccess,method:L.POST,params:e},{isShowErrorMessage:!0,successMessageText:"创建成功"})}(n)).finally((()=>l.confirmLoading=!1)),l.visible=!1,e?.callback?.()}catch(n){l.confirmLoading=!1}}}}});const H=k(" 模块 "),$=k(" 菜单 "),z=["href"],B=k(" 否 "),J=k(" 是 ");G.render=function(e,a,t,o,n,d){const s=v("a-select-option"),i=v("a-select"),r=v("a-form-item"),u=v("a-input"),c=v("a-input-number"),m=v("a-form"),f=v("a-modal");return y(),b(f,{visible:e.visible,"onUpdate:visible":a[9]||(a[9]=a=>e.visible=a),width:600,title:Number.isInteger(e.fields.id)?"编辑资源":"新增资源","confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:R((()=>[l(m,{ref:"formRef",model:e.modelRef,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:R((()=>[l(r,{label:"类别",rules:e.rules.type,name:"type"},{default:R((()=>[l(i,{value:e.modelRef.type,"onUpdate:value":a[0]||(a[0]=a=>e.modelRef.type=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择类型"},{default:R((()=>[l(s,{value:1},{default:R((()=>[H])),_:1}),l(s,{value:2},{default:R((()=>[$])),_:1})])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),1==e.modelRef.type?(y(),b(r,{key:0,label:"模块名称",rules:e.rules.moduleName,name:"moduleName"},{default:R((()=>[l(u,{value:e.modelRef.moduleName,"onUpdate:value":a[1]||(a[1]=a=>e.modelRef.moduleName=a),disabled:Number.isInteger(e.fields.id),placeholder:"请输入模块名称"},null,8,["value","disabled"])])),_:1},8,["rules"])):w("",!0),2==e.modelRef.type?(y(),b(r,{key:1,label:"模块名称",rules:e.rules.moduleId,name:"moduleId"},{default:R((()=>[l(i,{value:e.modelRef.moduleId,"onUpdate:value":a[2]||(a[2]=a=>e.modelRef.moduleId=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择模块"},{default:R((()=>[(y(!0),g(x,null,h(e.moduleList,(e=>(y(),b(s,{key:e.id,value:e.id},{default:R((()=>[k(I(e.moduleName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},8,["rules"])):w("",!0),2==e.modelRef.type?(y(),b(r,{key:2,label:"菜单名称",rules:e.rules.actionName,name:"actionName"},{default:R((()=>[l(u,{value:e.modelRef.actionName,"onUpdate:value":a[3]||(a[3]=a=>e.modelRef.actionName=a),placeholder:"请输入菜单名称"},null,8,["value"])])),_:1},8,["rules"])):w("",!0),l(r,{label:"文件路径",name:"viewPath",rules:[{required:2==e.modelRef.type,message:"请输入页面对应的文件路径"}]},{default:R((()=>[l(i,{value:e.modelRef.viewPath,"onUpdate:value":a[4]||(a[4]=a=>e.modelRef.viewPath=a),allowClear:1==e.modelRef.type,placeholder:"请选择页面对应的文件路径"},{default:R((()=>[(y(!0),g(x,null,h(e.constantRouterComponents,((e,a)=>(y(),b(s,{key:a,value:a},{default:R((()=>[k(I(a),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","allowClear"])])),_:1},8,["rules"]),l(r,{label:"路径",rules:e.rules.url,name:"url"},{default:R((()=>[l(u,{value:e.modelRef.url,"onUpdate:value":a[5]||(a[5]=a=>e.modelRef.url=a),placeholder:"请输入路径"},null,8,["value"])])),_:1},8,["rules"]),l(r,{label:"小图标"},{default:R((()=>[l(u,{value:e.modelRef.icon,"onUpdate:value":a[6]||(a[6]=a=>e.modelRef.icon=a),placeholder:"小图标"},null,8,["value"]),A("a",{href:`${e.prefix}#/icons`,target:"_blank"},"可选图标",8,z)])),_:1}),l(r,{label:"排序"},{default:R((()=>[l(c,{value:e.modelRef.sort,"onUpdate:value":a[7]||(a[7]=a=>e.modelRef.sort=a),min:1,placeholder:"排序"},null,8,["value"])])),_:1}),l(r,{label:"keepAlive",name:"keepAlive"},{default:R((()=>[l(i,{value:e.modelRef.keepAlive,"onUpdate:value":a[8]||(a[8]=a=>e.modelRef.keepAlive=a),placeholder:"是否缓存页面"},{default:R((()=>[l(s,{value:0},{default:R((()=>[B])),_:1}),l(s,{value:1},{default:R((()=>[J])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model","label-col","wrapper-col"])])),_:1},8,["visible","title","confirm-loading","afterClose","onOk"])};const Q=[{title:"名称",dataIndex:"moduleName",slots:{customRender:"moduleName"}},{title:"url地址",dataIndex:"url"},{title:"icon图标",dataIndex:"icon",slots:{customRender:"icon"},slotsType:"component",slotsFunc:e=>l(j,{type:e.icon})},{title:"排序",dataIndex:"sort"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>O(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>O(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>e.id<6?_.warn("系统预置菜单，不能删除！"):await K(e.id).then((()=>a()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},a)=>U(G,{fields:e,callback:a})}]}];var V=e("default",n({name:"SystemAccess",components:{DynamicTable:T},setup(){const e=c(),n=c({}),s=m({rowSelection:{onChange:(e,a)=>{s.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),i=N((()=>0==s.rowSelection.selectedRowKeys.length));return{...p(s),columns:Q,itemRefs:n,tableRef:e,isDisabled:i,expand:async(e,d)=>{const s=n.value[d.id],i=await(async({expanded:e,record:n,expandItemEl:d,asyncFunc:s,params:i})=>{if(e&&n.children&&!Array.isArray(n.children)){if(d){const e=d.closest("td").querySelector(".ant-table-row-expand-icon");return a(l(t),e),await o(),e.classList.add("loading-icon"),s(i).finally((async()=>{a(null,e),await o(),e.classList.remove("loading-icon")}))}return s(i)}})({expanded:e,record:d,expandItemEl:s,asyncFunc:D,params:{id:d.id,limit:100}});i?.data&&(d.children=i.data)},getAdminAccess:D,addItem:()=>{U(G,{callback:()=>{e.value?.refreshTableData()}})},deleteItems:()=>{d.confirm({title:"提示",icon:l(C),content:"您确定要删除所有选中吗？",onOk:async()=>{await K(s.rowSelection.selectedRowKeys.toString()),await(e.value?.refreshTableData()),s.rowSelection.selectedRowKeys=[]}})}}}}));const W=k(" 添加 "),X=k(" 删除 ");V.render=function(e,a,t,o,n,d){const s=v("a-button"),i=v("dynamic-table"),r=E("permission");return y(),b(i,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminAccess,rowKey:"id","row-selection":e.rowSelection,onExpand:e.expand},{title:R((()=>[S(l(s,{type:"primary",onClick:e.addItem},{default:R((()=>[W])),_:1},8,["onClick"]),[[r,{action:"create",effect:"disabled"}]]),S(l(s,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:R((()=>[X])),_:1},8,["disabled","onClick"]),[[r,{action:"delete"}]])])),moduleName:R((({record:a})=>[A("span",{ref:l=>l&&(e.itemRefs[a.id]=l)},I(a.moduleName||a.actionName),513)])),_:1},8,["columns","get-list-func","row-selection","onExpand"])}}}}))}();
