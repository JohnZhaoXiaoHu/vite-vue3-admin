var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,r=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(o)for(var a of o(t))l.call(t,a)&&s(e,a,t[a]);return e},u=(e,o)=>t(e,a(o));import{r as c,b4 as i,d,an as p,ap as m,ad as f,b7 as b,s as y,aB as g,q as v,p as h,h as w,E as S,b8 as O,e as k,c as C,am as x,k as j,w as R,a as D,b9 as z,ba as E,a8 as _,i as T,F,H as I,a0 as $,b as N,t as P,l as L,G as W,av as A,u as B,bb as M,j as X,n as q}from"./vendor.f13de6ab.js";import{g as H}from"./index.fc610771.js";const K=e=>{let t,a,o,n;const l=()=>n.onmouseup=n.onmousedown=n.onmousemove=null;e.forEach((s=>{var c,i;const d=null!=(i=null==(c=null==s?void 0:s.customHeaderCell)?void 0:c.call(s,e))?i:{};s.customHeaderCell=e=>u(r({},d),{onmouseenter:()=>{n=e.title[0].el.closest("th"),null!=o||(o=n.closest(".ant-table-wrapper")),null!=a||(a=o.clientWidth),n.onmousemove=function(e){e.offsetX>this.offsetWidth-10?this.style.cursor="col-resize":this.style.cursor="default",null==t&&(t=this),null!=t.mouseDown&&1==t.mouseDown&&(t.style.cursor="default",t.oldWidth+(e.x-t.oldX)>0&&(t.width=t.oldWidth+(e.x-t.oldX)),t.style.width=t.width,o.style.width=a+(e.x-t.oldX)+"px",t.style.cursor="col-resize")},n.onmousedown=function(e){t=this,e.offsetX>t.offsetWidth-10&&(t.mouseDown=!0,t.oldX=e.x,t.oldWidth=t.offsetWidth)},n.onmouseup=l,o.onmouseup=function(){l(),null==t&&(t=this),t.mouseDown=!1,t.style.cursor="default",a=o.clientWidth}},onmouseup:()=>l})}))};var Q=d({name:"DynamicTable",components:{Table:p,[m.name]:m,[f.name]:f,[b.name]:b,Option:f.Option},inheritAttrs:!1,props:{dataSource:{type:Array},columns:{type:Object,required:!0},getListFunc:{type:Function},rowSelection:{type:Object},rowKey:{type:[String,Function]},pageOption:{type:Object,default:()=>({})},showSummary:{type:Boolean,default:!1},sumText:{type:String,default:"合计"},summaryFunc:{type:Function},dragColEnable:{type:Boolean,default:!0},dragRowEnable:Boolean},emits:["change","update:pageOption"],setup(e,{emit:t,slots:a}){var o;const n=c(),{pageOptions:l}=function(e){const t=c(r({current:1,pageSize:10,total:0,pageSizeOptions:["10","20","30","40","50"],showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`,onChange:(t,a)=>{var o;return null==(o=null==e?void 0:e.pageChange)?void 0:o.call(e,t,a)},onShowSizeChange:(t,a)=>{var o;return null==(o=null==e?void 0:e.pageChange)?void 0:o.call(e,t,a)}},e));return{pageOptions:t,updatePageOption:(e={})=>{Object.assign(t.value,e)}}}(),{setCalculateRow:s}=(()=>{let e;return{setCalculateRow:async t=>{var a;await i();const{tableRef:o,dataSource:n=[],columns:l=[],sumText:s,summaryFunc:r}=t;if(!n.length)return;const u=o.value.$el.querySelector(".ant-table-tbody");e||(e=null==(a=u.lastElementChild)?void 0:a.cloneNode(!0),e.style.backgroundColor="#f8f8f9",e.style.position="sticky",e.style.zIndex="999",e.style.bottom="0",e.setAttribute("data-row-key",String(Math.random())));const c=t=>{if(H(r)){const t=r({dataSource:n,columns:l});[...e.children].forEach(((e,a)=>{e.textContent=t[a],e.style.backgroundColor="inherit"}))}else{const t=Object.keys(n[0]).reduce(((e,t)=>{const a=n.map((e=>e[t])).reduce(((e,t)=>t+e),0);return e[t]=isNaN(Number(a))?"N/A":a,e}),{}),a=l.map((e=>{var t;return null!=(t=e.dataIndex)?t:e.key}));[...e.children].forEach(((e,o)=>{e.textContent=0==o?s:t[a[o]],e.style.backgroundColor="inherit"}))}(null==t?void 0:t.length)&&[...e.children].forEach(((e,a)=>{Object.keys(t[a].style||[]).forEach((o=>{const n=t[a].style[o];e.style[n]=t[a].style[n],e.className=t[a].className}))}))};c(),u.contains(e)||(u.appendChild(e),setTimeout((()=>{var e,t;const a=null==(t=null==(e=o.value.$el.querySelector(".ant-table-tbody"))?void 0:e.firstElementChild)?void 0:t.children;a&&c([...a])}),500))}}})();Object.assign(l.value,e.pageOption),e.dragColEnable&&K(e.columns);const d=y({expandItemRefs:{},customRow:()=>({}),tableData:[],actions:(null==(o=e.columns.find((e=>[e.dataIndex,e.key].includes("action"))))?void 0:o.actions)||[],loading:!1});g((()=>e.dataSource),(e=>{e&&(d.tableData=e)}),{deep:!0,immediate:!0});const p=async(t={},a=!1)=>{var o;if(Object.is(e.dataSource,void 0)&&Object.prototype.toString.call(e.getListFunc).includes("Function")){const n=r(r({pageNumber:a?1:l.value.current,pageSize:l.value.pageSize},e.pageOption),t);d.loading=!0;const{data:s,pageNumber:u,pageSize:c,total:i}=await(null==(o=null==e?void 0:e.getListFunc)?void 0:o.call(e,n).finally((()=>d.loading=!1)));Object.assign(l.value,{current:~~u,pageSize:~~c,total:~~i}),d.tableData=s}if(e.showSummary){const{pageSize:t,current:a}=l.value,o=Math.max(t,a*t),r=Object.is(e.dataSource,void 0)?d.tableData:d.tableData.slice(o-t,o);s({columns:e.columns,dataSource:r,tableRef:n,sumText:e.sumText,summaryFunc:e.summaryFunc})}e.dragRowEnable&&(d.customRow=function(e){let t,a;return o=>({draggable:!0,ondrag(e){t=o},ondrop(e){a=o},ondragend(o){if(t!==a){const o=e.indexOf(t),n=e.indexOf(a);[e[o],e[n]]=[e[n],e[o]]}},ondragover:e=>!1})}(d.tableData))};p();return u(r({},v(d)),{tableRef:n,pageOptions:l,buttonProps:{size:"small"},actionEvent:async(t,a,o="")=>{await a({record:t,props:e},(()=>setTimeout((()=>p())))),"del"==o&&d.tableData.length<2&&(l.value.current=Math.max(1,l.value.current-1))},refreshTableData:p,paginationChange:(a,o,n,{currentDataSource:s})=>{const{field:c,order:i}=n;l.value=r(r({},l.value),a),p(u(r(r({pageSize:a.pageSize,pageNumber:a.current},e.pageOption),o),{field:c,order:i})),t("change",a,o,n,{currentDataSource:s})}})}});h("data-v-fedbcd46");const G=N(" 您确定要删除吗？ ");w(),Q.render=function(e,t,a,o,n,l){const s=S("a-button"),u=S("a-popconfirm"),c=S("Table"),i=O("permission");return k(),C(c,_({ref:"tableRef",columns:e.columns,loading:e.loading,rowSelection:e.rowSelection,rowKey:e.rowKey,size:"middle","data-source":e.tableData,pagination:e.pageOptions,bordered:"",customRow:e.customRow},e.$attrs,{onChange:e.paginationChange}),x({_:2},[j(e.$slots,((t,a)=>({name:a,fn:R((t=>[D(e.$slots,a,z(E(t)),void 0,!0)]))}))),j(e.columns.filter((e=>{var t;return!!(null==(t=e.slots)?void 0:t.customRender)})),(t=>({name:t.slots.customRender,fn:R((a=>{var o,n,l,c,d,p,m,f;return[(null==(o=t.slots)?void 0:o.customRender)&&e.$slots[null==(n=t.slots)?void 0:n.customRender]?D(e.$slots,null==(l=t.slots)?void 0:l.customRender,z(_({key:0},a)),void 0,!0):(k(),T(F,{key:1},["action"!==(null==(c=t.slots)?void 0:c.customRender)?(k(),T(F,{key:0},["component"==t.slotsType?(k(),C(I(null==(d=null==t?void 0:t.slotsFunc)?void 0:d.call(t,a.record)),{key:0})):$("",!0),"format"==t.slotsType?(k(),T(F,{key:1},[N(P(null==(m=null==t?void 0:t.slotsFunc)?void 0:m.call(t,a.record[null!=(p=t.dataIndex)?p:t.key],a.record)),1)],64)):$("",!0)],64)):$("",!0),"action"==(null==(f=t.slots)?void 0:f.customRender)?(k(),T("div",{key:t.slots.customRender,class:"actions"},[(k(!0),T(F,null,j(e.actions,((t,o)=>(k(),T(F,null,["button"===t.type?L((k(),C(s,_({key:0},r(r({},e.buttonProps),t.props),{key:o,onClick:o=>e.actionEvent(a.record,t.func)}),{default:R((()=>[N(P(t.text),1)])),_:2},1040,["onClick"])),[[i,t.permission]]):$("",!0),"popconfirm"===t.type?(k(),C(u,{key:o,placement:"leftTop",onConfirm:o=>e.actionEvent(a.record,t.func,"del")},{title:R((()=>[G])),default:R((()=>[L(W(s,z(E(r(r({},e.buttonProps),t.props))),{default:R((()=>[N(P(t.text),1)])),_:2},1040),[[i,t.permission]])])),_:2},1032,["onConfirm"])):$("",!0)],64)))),256))])):$("",!0)],64))]}))})))]),1040,["columns","loading","rowSelection","rowKey","data-source","pagination","customRow","onChange"])},Q.__scopeId="data-v-fedbcd46";const J=d({name:"TableQueryHeader",components:{DownOutlined:A},props:{defaultShowItems:{type:Number,default:2}},setup(e,{slots:t}){const a=y({advanced:!1,labelMap:{}}),o=B((()=>Object.keys(t).slice(0,e.defaultShowItems))),n=B((()=>Object.keys(t).slice(e.defaultShowItems).filter((e=>"buttons"!==e)))),l=B((()=>(a.advanced?.5:0)+"turn"));return u(r({},v(a)),{turn:l,defaultShowSlots:o,advancedShowSlots:n,calcSubBtnOffset:o=>{const n=(a.advanced?Object.keys(t).length:e.defaultShowItems)*o,l=n%24;return n<24||0===l?0:24-l},setLabel:e=>t=>{a.labelMap[e]=t},toggleAdvanced:()=>{a.advanced=!a.advanced}})}}),U=()=>{M((e=>({"7cb6967a":e.turn})))},V=J.setup;J.setup=V?(e,t)=>(U(),V(e,t)):U;var Y=J;Y.render=function(e,t,a,o,n,l){const s=S("a-form-item"),r=S("a-col"),u=S("DownOutlined"),c=S("a-row"),i=S("a-form");return k(),C(i,{layout:"inline"},{default:R((()=>[W(c,{gutter:[24,24]},{default:R((()=>[(k(!0),T(F,null,j(e.defaultShowSlots,(t=>(k(),C(r,{key:t,md:8,sm:24},{default:R((()=>[W(s,{label:e.labelMap[t]||""},{default:R((()=>[D(e.$slots,t,{setLabel:e.setLabel(t)},void 0,!0)])),_:2},1032,["label"])])),_:2},1024)))),128)),e.advanced?(k(!0),T(F,{key:0},j(e.advancedShowSlots,(t=>(k(),C(r,{key:t,md:8,sm:24},{default:R((()=>[W(s,{label:e.labelMap[t]||""},{default:R((()=>[D(e.$slots,t,{setLabel:e.setLabel(t)},void 0,!0)])),_:2},1032,["label"])])),_:2},1024)))),128)):$("",!0),W(r,{md:{span:8,offset:e.calcSubBtnOffset(8)},sm:24},{default:R((()=>[X("span",{class:"table-page-search-submitButtons",style:q(e.advanced&&{float:"right",overflow:"hidden"}||{})},[D(e.$slots,"buttons",{},void 0,!0),8*Object.keys(e.$slots).length>24?(k(),T("a",{key:0,style:{"margin-left":"8px"},onClick:t[0]||(t[0]=(...t)=>e.toggleAdvanced&&e.toggleAdvanced(...t))},[N(P(e.advanced?"收起":"展开")+" ",1),W(u,{class:"collapse-icon"})])):$("",!0)],4)])),_:3},8,["md"])])),_:3})])),_:3})},Y.__scopeId="data-v-4bfdf15e";export{Q as _,Y as a};
