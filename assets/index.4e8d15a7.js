var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,d=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&d(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&d(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{ak as i,G as u,R as c,b4 as m,d as f,M as p,af as v,aa as b,ab as y,ad as w,r as R,s as h,f as g,q as I,E as k,e as A,c as x,w as _,a0 as N,i as O,k as j,b as C,t as E,F as S,j as P,A as T,u as q,aU as L,b8 as U,l as M}from"./vendor.f13de6ab.js";import{_ as D}from"./index.e22eb348.js";import{A as F,R as K,h as G,j as H,k as $}from"./index.fc610771.js";import{I as z}from"./icon-font.deb5a5ed.js";var B,J;function Q(e){return F.request({url:B.adminAccess,method:K.GET,params:e})}function V(e){return F.request({url:[B.adminAccess,e].join("/"),method:K.DELETE},{isShowErrorMessage:!0,successMessageText:"删除成功"})}(J=B||(B={})).adminAccess="/admin/access",J.adminAccessModule="/admin/access/module";var W=f({name:"OperateModal",components:{[p.name]:p,[v.name]:v,[v.Item.name]:v.Item,[b.name]:b,[y.name]:y,[w.name]:w,ASelectOption:w.Option},props:{remove:{type:Function},fields:{type:Object,default:()=>({})},callback:{type:Function}},setup(e){const a=R(null),l=h({visible:!0,confirmLoading:!1,moduleList:[]}),t=h({moduleName:"",moduleId:void 0,actionName:"",viewPath:"",type:void 0,url:"",icon:"",sort:1,keepAlive:1});e.fields.moduleId&&(Object.keys(t).forEach((a=>t[a]=e.fields[a])),t.type=-1==e.fields.moduleId?1:2);g((async()=>{var e;l.moduleList=await F.request({url:B.adminAccessModule,method:K.GET,params:e})}));return r(n({},I(l)),{formRef:a,rules:{moduleName:[{required:!0,message:"模块名称不能为空"}],moduleId:[{required:!0,message:"模块名称不能为空"}],actionName:[{required:!0,message:"请输入菜单名称"}],type:[{required:!0,message:"请选择类型"}],url:[{required:!0,message:"请输入url地址"}]},prefix:"/vite-vue3-admin/",labelCol:{span:4},wrapperCol:{span:20},modelRef:t,constantRouterComponents:G,handleOk:async o=>{var s;o.preventDefault(),l.confirmLoading=!0;try{await a.value.validate();const o=e.fields.id,d=n({},t);null!=d.viewPath||(d.viewPath=""),o&&Reflect.deleteProperty(d,"type"),await(o?function(e,a){return F.request({url:[B.adminAccess,e].join("/"),method:K.PATCH,params:a},{isShowErrorMessage:!0,successMessageText:"修改成功"})}(o,d):function(e){return F.request({url:B.adminAccess,method:K.POST,params:e},{isShowErrorMessage:!0,successMessageText:"创建成功"})}(d)).finally((()=>l.confirmLoading=!1)),l.visible=!1,null==(s=null==e?void 0:e.callback)||s.call(e)}catch(d){l.confirmLoading=!1}}})}});const X=C(" 模块 "),Y=C(" 菜单 "),Z=["href"],ee=C(" 否 "),ae=C(" 是 ");W.render=function(e,a,l,t,o,s){const d=k("a-select-option"),n=k("a-select"),r=k("a-form-item"),i=k("a-input"),c=k("a-input-number"),m=k("a-form"),f=k("a-modal");return A(),x(f,{visible:e.visible,"onUpdate:visible":a[9]||(a[9]=a=>e.visible=a),width:600,title:Number.isInteger(e.fields.id)?"编辑资源":"新增资源","confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:_((()=>[u(m,{ref:"formRef",model:e.modelRef,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:_((()=>[u(r,{label:"类别",rules:e.rules.type,name:"type"},{default:_((()=>[u(n,{value:e.modelRef.type,"onUpdate:value":a[0]||(a[0]=a=>e.modelRef.type=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择类型"},{default:_((()=>[u(d,{value:1},{default:_((()=>[X])),_:1}),u(d,{value:2},{default:_((()=>[Y])),_:1})])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),1==e.modelRef.type?(A(),x(r,{key:0,label:"模块名称",rules:e.rules.moduleName,name:"moduleName"},{default:_((()=>[u(i,{value:e.modelRef.moduleName,"onUpdate:value":a[1]||(a[1]=a=>e.modelRef.moduleName=a),disabled:Number.isInteger(e.fields.id),placeholder:"请输入模块名称"},null,8,["value","disabled"])])),_:1},8,["rules"])):N("",!0),2==e.modelRef.type?(A(),x(r,{key:1,label:"模块名称",rules:e.rules.moduleId,name:"moduleId"},{default:_((()=>[u(n,{value:e.modelRef.moduleId,"onUpdate:value":a[2]||(a[2]=a=>e.modelRef.moduleId=a),disabled:Number.isInteger(e.fields.id),placeholder:"请选择模块"},{default:_((()=>[(A(!0),O(S,null,j(e.moduleList,(e=>(A(),x(d,{key:e.id,value:e.id},{default:_((()=>[C(E(e.moduleName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},8,["rules"])):N("",!0),2==e.modelRef.type?(A(),x(r,{key:2,label:"菜单名称",rules:e.rules.actionName,name:"actionName"},{default:_((()=>[u(i,{value:e.modelRef.actionName,"onUpdate:value":a[3]||(a[3]=a=>e.modelRef.actionName=a),placeholder:"请输入菜单名称"},null,8,["value"])])),_:1},8,["rules"])):N("",!0),u(r,{label:"文件路径",name:"viewPath",rules:[{required:2==e.modelRef.type,message:"请输入页面对应的文件路径"}]},{default:_((()=>[u(n,{value:e.modelRef.viewPath,"onUpdate:value":a[4]||(a[4]=a=>e.modelRef.viewPath=a),allowClear:1==e.modelRef.type,placeholder:"请选择页面对应的文件路径"},{default:_((()=>[(A(!0),O(S,null,j(e.constantRouterComponents,((e,a)=>(A(),x(d,{key:a,value:a},{default:_((()=>[C(E(a),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","allowClear"])])),_:1},8,["rules"]),u(r,{label:"路径",rules:e.rules.url,name:"url"},{default:_((()=>[u(i,{value:e.modelRef.url,"onUpdate:value":a[5]||(a[5]=a=>e.modelRef.url=a),placeholder:"请输入路径"},null,8,["value"])])),_:1},8,["rules"]),u(r,{label:"小图标"},{default:_((()=>[u(i,{value:e.modelRef.icon,"onUpdate:value":a[6]||(a[6]=a=>e.modelRef.icon=a),placeholder:"小图标"},null,8,["value"]),P("a",{href:`${e.prefix}#/icons`,target:"_blank"},"可选图标",8,Z)])),_:1}),u(r,{label:"排序"},{default:_((()=>[u(c,{value:e.modelRef.sort,"onUpdate:value":a[7]||(a[7]=a=>e.modelRef.sort=a),min:1,placeholder:"排序"},null,8,["value"])])),_:1}),u(r,{label:"keepAlive",name:"keepAlive"},{default:_((()=>[u(n,{value:e.modelRef.keepAlive,"onUpdate:value":a[8]||(a[8]=a=>e.modelRef.keepAlive=a),placeholder:"是否缓存页面"},{default:_((()=>[u(d,{value:0},{default:_((()=>[ee])),_:1}),u(d,{value:1},{default:_((()=>[ae])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model","label-col","wrapper-col"])])),_:1},8,["visible","title","confirm-loading","afterClose","onOk"])};const le=[{title:"名称",dataIndex:"moduleName",slots:{customRender:"moduleName"}},{title:"url地址",dataIndex:"url"},{title:"icon图标",dataIndex:"icon",slots:{customRender:"icon"},slotsType:"component",slotsFunc:e=>u(z,{type:e.icon})},{title:"排序",dataIndex:"sort"},{title:"创建时间",dataIndex:"createdAt",slots:{customRender:"createdAt"},slotsType:"format",slotsFunc:e=>H(e)},{title:"最后更新时间",dataIndex:"updatedAt",slots:{customRender:"updatedAt"},slotsType:"format",slotsFunc:e=>H(e)},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>e.id<6?T.warn("系统预置菜单，不能删除！"):await V(e.id).then((()=>a()))},{type:"button",text:"编辑",permission:{action:"update",effect:"disabled"},props:{type:"warning"},func:({record:e},a)=>$(W,{fields:e,callback:a})}]}];var te=f({name:"SystemAccess",components:{DynamicTable:D},setup(){const e=R(),a=R({}),l=h({rowSelection:{onChange:(e,a)=>{l.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),t=q((()=>0==l.rowSelection.selectedRowKeys.length));return r(n({},I(l)),{columns:le,itemRefs:a,tableRef:e,isDisabled:t,expand:async(e,l)=>{const t=a.value[l.id],o=await(async({expanded:e,record:a,expandItemEl:l,asyncFunc:t,params:o})=>{if(e&&a.children&&!Array.isArray(a.children)){if(l){const e=l.closest("td").querySelector(".ant-table-row-expand-icon");return i(u(c),e),await m(),e.classList.add("loading-icon"),t(o).finally((async()=>{i(null,e),await m(),e.classList.remove("loading-icon")}))}return t(o)}})({expanded:e,record:l,expandItemEl:t,asyncFunc:Q,params:{id:l.id,limit:100}});(null==o?void 0:o.data)&&(l.children=o.data)},getAdminAccess:Q,addItem:()=>{$(W,{callback:()=>{var a;null==(a=e.value)||a.refreshTableData()}})},deleteItems:()=>{p.confirm({title:"提示",icon:u(L),content:"您确定要删除所有选中吗？",onOk:async()=>{var a;await V(l.rowSelection.selectedRowKeys.toString()),await(null==(a=e.value)?void 0:a.refreshTableData()),l.rowSelection.selectedRowKeys=[]}})}})}});const oe=C(" 添加 "),se=C(" 删除 ");te.render=function(e,a,l,t,o,s){const d=k("a-button"),n=k("dynamic-table"),r=U("permission");return A(),x(n,{ref:"tableRef",columns:e.columns,"get-list-func":e.getAdminAccess,rowKey:"id","row-selection":e.rowSelection,onExpand:e.expand},{title:_((()=>[M(u(d,{type:"primary",onClick:e.addItem},{default:_((()=>[oe])),_:1},8,["onClick"]),[[r,{action:"create",effect:"disabled"}]]),M(u(d,{disabled:e.isDisabled,type:"primary",onClick:e.deleteItems},{default:_((()=>[se])),_:1},8,["disabled","onClick"]),[[r,{action:"delete"}]])])),moduleName:_((({record:a})=>[P("span",{ref:l=>l&&(e.itemRefs[a.id]=l)},E(a.moduleName||a.actionName),513)])),_:1},8,["columns","get-list-func","row-selection","onExpand"])};export{te as default};
